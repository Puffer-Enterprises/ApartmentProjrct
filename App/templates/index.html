{% extends "layout.html" %}
{% block title %}Flask MVC App{% endblock %}
{% block page %}Flask MVC App{% endblock %}

{% block content %}
{% if is_authenticated %}
    {% if not selected_apartment %}

        {% if tenant_boolean %}
            <p>You are a tenant. Thus you can only review your apartment.</p>
            {% if user_apartment2 %}
                <p>You are the tenant of apartment number {{user_apartment2.id}}</p>
            {% else %}
                <p>You are not a current tenant of any apartment.</p>
            {% endif %}
        {% elif landlord_boolean %}
            <p>You are a landlord. Thus you can create apartment listings.</p>
        {% endif %}

    {% endif %}

    <h1 class="titling">APARTMENTS</h1>

    <!-- Search Section -->
    <div class="search-section container">
        <p>Search for Apartments</p>
        <form action="/apartments/search" method="GET" class="search-form">
            <div class="row">
                <div class="input-field col s12 m6">
                    <input id="town" type="text" name="town" class="validate">
                    <label for="town">Town</label>
                </div>
                <div class="input-field col s12 m6">
                    <input id="min_bedrooms" type="number" name="min_bedrooms" min="0" class="validate">
                    <label for="min_bedrooms">Minimum Bedrooms</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12 m6">
                    <input id="min_bathrooms" type="number" name="min_bathrooms" min="0" class="validate">
                    <label for="min_bathrooms">Minimum Bathrooms</label>
                </div>
                <div class="input-field col s12 m6">
                    <input id="max_rent" type="number" name="max_rent" min="0" step="0.01" class="validate">
                    <label for="max_rent">Maximum Rent</label>
                </div>
            </div>
            <div class="row">
                <div class="col s12">
                    <button type="submit" class="btn waves-effect waves-light">Search</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Apartment Cards Section -->
    <div class="row">
        {% for apart in apartments %}
            <div class="col s12 m6 l4">
                <div class="card">
                    <div class="card-content">
                        <div class="apartment">
                            <p><strong>Apartment No. {{ apart.id }}</strong></p>
                            <img src="{{ apart.image }}" alt="Apartment Image" style="width:100%; height:auto;">
                            <p class="location"><b>{{ apart.street }}, {{ apart.town }}</b></p>
                        </div>
                        <div class="features" style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <div class="feature"><i class="fa fa-bath"></i> {{ apart.bathrooms }}</div>
                            <div class="feature"><i class="fa fa-bed"></i> {{ apart.bedrooms }}</div>
                        </div>
                        <p>Rent: ${{ apart.rent }}0</p>
                    </div>
                    <div class="card-action">
                        <a class="red btn" href="/apartments/{{ apart.id }}">VIEW</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {% if selected_apartment %}
        <div class="reviews-container">
            <h1 class="page-title">Former Tenant Reviews for Apartment Number {{ selected_apartment.id }}</h1>
            <div class="reviews">
                {% for review in reviews %}
                    <div class="review">
                        <p class="review-comment">"<strong>{{ review.comment }}</strong>"</p>
                        <div class="rating-stars">
                            <span class="stars" style="--rating: {{ review.rating }};" aria-label="Rating: {{ review.rating }}"></span>
                            <p class="rating-text">Rating: {{ review.rating }} / 5</p>
                        </div>
                    </div>
                {% endfor %}
                {% if not reviews %}
                    <p class="no-reviews">No reviews available for this apartment.</p>
                {% endif %}
            </div>

            {% if selected_apartment.id == user_apartment.id %}
                <div class="leave-review">
                    <p class="tenant-info">You are the tenant of this apartment.</p>
                    <h1 class="form-title">Leave a Review</h1>
                    <form action="/apartments/{{ selected_apartment.id }}/{{ tenant.id }}/review" method="POST" class="review-form">
                        <div class="form-group">
                            <label for="comment">Comment:</label>
                            <textarea id="comment" name="comment" placeholder="Share your experience..." required></textarea>
                        </div>
                        <div class="form-group rating-input">
                            <label for="rating">Rating:</label>
                            <div class="stars-input">
                                {% for i in range(5, 0, -1) %}
                                    <input type="radio" id="star-{{ i }}" name="rating" value="{{ i }}">
                                    <label for="star-{{ i }}" class="fa fa-star"></label>
                                {% endfor %}
                            </div>
                        </div>
                        <button type="submit" class="btn-submit">Submit Review</button>
                    </form>
                </div>
            {% else %}
                <p class="not-tenant">You are not the tenant of this apartment.</p>
            {% endif %}
        </div>
    {% endif %}

    {% if landlord_boolean %}
        <div class="add-apartment">
            <h2>Add a New Apartment</h2>
            <form action="/apartments/add" method="POST">
                <div class="form-group">
                    <label for="street">Street:</label>
                    <input type="text" id="street" name="street" placeholder="Enter street" required>
                </div>
                <div class="form-group">
                    <label for="town">Town:</label>
                    <input type="text" id="town" name="town" placeholder="Enter town" required>
                </div>
                <div class="form-group">
                    <label for="rent">Rent ($):</label>
                    <input type="number" id="rent" name="rent" step="0.01" placeholder="Enter rent amount" required>
                </div>
                <div class="form-group">
                    <label for="bedrooms">Bedrooms:</label>
                    <input type="number" id="bedrooms" name="bedrooms" placeholder="Enter number of bedrooms" required>
                </div>
                <div class="form-group">
                    <label for="bathrooms">Bathrooms:</label>
                    <input type="number" id="bathrooms" name="bathrooms" placeholder="Enter number of bathrooms" required>
                </div>
                <div class="form-group">
                    <label for="image">Image URL (optional):</label>
                    <input type="text" id="image" name="image" placeholder="Enter image URL">
                </div>
                <button type="submit" class="btn">Add Apartment</button>
            </form>
        </div>
    {% endif %}
{% else %}
    <p>Not logged in</p>
{% endif %}
{% endblock %}
